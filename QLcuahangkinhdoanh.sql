CREATE DATABASE QLcuahangkinhdoanh
GO

USE QLcuahangkinhdoanh
GO

CREATE TABLE KHACH
(
MAKHACH NVARCHAR(6) NOT NULL PRIMARY KEY,
TEN_KH NVARCHAR(30) NOT NULL,
DIACHI_KH NVARCHAR(30)
)
GO

CREATE TABLE HANG
(
MAHANG NVARCHAR(6) NOT NULL PRIMARY KEY,
TEN_HANG NVARCHAR(15),
MOTA_HANG NVARCHAR(30),
DON_VI NVARCHAR(10)
)
GO

CREATE TABLE DONHANG
(
SO_DON NVARCHAR(6) NOT NULL PRIMARY KEY,
MAKHACH NVARCHAR(6) NOT NULL,
NGAY_DON [DATE],
FOREIGN KEY(MAKHACH) REFERENCES KHACH(MAKHACH)
)
GO

CREATE TABLE DONGDON
(
SO_DON NVARCHAR(6) NOT NULL,
MAHANG NVARCHAR(6) NOT NULL,
SO_LUONGD INT,
FOREIGN KEY(SO_DON) REFERENCES DONHANG(SO_DON),
FOREIGN KEY(MAHANG) REFERENCES HANG(MAHANG)
)
GO
INSERT INTO DONGDON
VALUES
(
	N'DH001',
	N'H001',
	3
),
(
	N'DH002',
	N'H002',
	8
),
(
	N'DH003',
	N'H003',
	12
)
DELETE FROM DONGDON
SELECT *FROM DONGDON
CREATE TABLE PHIEUGIAO
(
SO_PHIEU NVARCHAR(6) NOT NULL PRIMARY KEY,
MAKHACH NVARCHAR(6) NOT NULL,
NGAY_GIAO [DATE],
NOI_GIAO NVARCHAR(30),
TONG_TIEN INT,
FOREIGN KEY(MAKHACH) REFERENCES KHACH(MAKHACH)
)
GO
INSERT INTO PHIEUGIAO
VALUES
(
	N'P001',
	N'K001',
	'1/10/2021',
	N'HÀ NỘI',
	100
),
(
	N'P002',
	N'K002',
	'2/10/2021',
	N'HÀ NỘI',
	150
),
(
	N'P003',
	N'K003',
	'5/10/2021',
	N'HẢI PHÒNG',
	200
)
SELECT*FROM PHIEUGIAO
CREATE TABLE DONGPHIEU
(
SO_PHIEU NVARCHAR(6) NOT NULL,
MAHANG NVARCHAR(6) NOT NULL,
DON_GIA INT,
SO_LUONGGI INT,
FOREIGN KEY(SO_PHIEU) REFERENCES PHIEUGIAO(SO_PHIEU),
FOREIGN KEY(MAHANG) REFERENCES HANG(MAHANG)
)
GO
INSERT INTO DONGPHIEU
VALUES
(
	N'P001',
	N'H001',
	100,
	3
),
(
	N'P002',
	N'H002',
	150,
	5
),
(
	N'P003',
	N'H003',
	200,
	6
)
SELECT *FROM DONGPHIEU
ALTER TABLE KHACH -- Thêm thuộc tính
ADD SOTHICH NVARCHAR(30)
ALTER TABLE HANG
ADD NOICUNGCAP NVARCHAR (30),
	NOISANXUAT NVARCHAR (30)

ALTER TABLE KHACH --Thay đổi kiểu của thuộc tính
	ALTER COLUMN SOTHICH NVARCHAR(MAX) NOT NULL
ALTER TABLE HANG
	ALTER COLUMN NOICUNGCAP INT NOT NULL

ALTER TABLE HANG --Xóa thuộc tính
	DROP COLUMN NOICUNGCAP,NOISANXUAT 
ALTER TABLE KHACH
	DROP COLUMN SOTHICH

INSERT INTO KHACH
VALUES
(
	N'K001',
	N'Nguyễn Thành Long',
	N'Đại học Thủy Lợi'
),
(
	N'K002',
	N'Nguyễn Văn Minh',
	N'Đại học VHNT'
),
(
	N'K003',
	N'Mai Thị Đào',
	N'Đại học Quốc Gia'
)
select*from khach

INSERT INTO DONHANG
VALUES
(
	N'DH001',
	N'K001',
	'03/22/2002'
),
(
	N'DH002',
	N'K001',
	'07/13/2003'
),
(
	N'DH003',
	N'K002',
	'12/24/2002'
)
--Hãy thử trường hợp thêm ma_khach là K0010 vào bảng DONHANG thì kết quả thế nào? Xảy ra xung đột ràng buộc với khóa chính trong bảng khách
delete from DONHANG
select*from donhang

INSERT INTO KHACH
VALUES
(
	N'K004',
	N'Phạm Thị Ngọc',
	N''
),
(
	N'K005',
	N'Nguyễn Văn Thông',
	N'Đại học Thủy Lợi'
)

select*from khach

INSERT INTO HANG
VALUES
(
	N'H001',
	N'Hoa loa kèn',
	N'Hoa trắng, to',
	N'Bông'
),
(
	N'H002',
	N'Hoa hồng',
	N'Nhiều màu',
	N'Bông'
),
(
	N'H003',
	N'Hoa lan',
	N'',
	N'Cành'
)
DELETE FROM HANG
delete from HANG where MAHANG='H001';
delete from KHACH 
where DIACHI_KH like 'Đại học Thủy Lợi';
delete from KHACH 
where TEN_KH='Nguyễn Văn Thông'

select*from khach

UPDATE KHACH SET DIACHI_KH = N'Đại học Quốc Gia' 
WHERE MAKHACH = 'K002';

UPDATE HANG SET TEN_HANG=N'Hoa phong lan' , MOTA_HANG=N'Hàng nhập khẩu từ Đà Lạt'
where TEN_HANG=N'Hoa lan'

SELECT*From KHACH--CAU 1
SELECT*From HANG--CAU 2
SELECT*From DONHANG--CAU 3

SELECT TEN_KH,DIACHI_KH FROM KHACH--CAU 4

SELECT TEN_HANG,MOTA_HANG,DON_VI FROM HANG--CAU 5
SELECT DON_VI FROM HANG--CAU 6
SELECT TEN_HANG FROM HANG--CAU 7
SELECT DIACHI_KH FROM KHACH--CAU 8


